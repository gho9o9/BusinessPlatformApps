{
    "Install": {
        "Pages": [
            {
                "architectureDiagram": "dist/Apps/Microsoft/Released/Microsoft-Workforce/Web/Images/creditAndCollectionsArchDiagram.png",
                "displayname": "Getting Started",
                "list1": [
                    "$translate(INIT_GETTING_STARTED_AZURE_SUBSCRIPTION)",
                    "$translate(INIT_GETTING_STARTED_PBI_DESKTOP)",
                    "$translate(INIT_GETTING_STARTED_PBI_PRO)"
                ],
                "list2": [
                    "$translate(INIT_GETTING_STARTED_CLOUD_SOLUTION)",
                    "$translate(INIT_GETTING_STARTED_CONNECT_AS_PBI)"
                ],
                "name": "$SiteCommon$/pages-gallery/getting-started.html",
                "templateName": "$translate(AX_WORKFORCE_TEMPLATE_TITLE)"
            },
            {
                "azureProviders": [
                    "Microsoft.Web"
                ],
                "displayname": "Login",
                "name": "$SiteCommon$/pages-gallery/azure-login.html"
            },
            {
                "displayname": "Dynamics 365 Login",
                "name": "$SiteCommon$/pages-gallery/ax-login.html"
            },
            {
                "displayname": "Dynamics 365 Connector",
                "ConnectorName": "$save('dynamicsax')",
                "RequiresConsent": "$save('true')",
                "name": "$SiteCommon$/pages-gallery/ax-connector-login.html"
            },
            {
                "checkSqlVersion": true,
                "displayname": "Target",
                "isAzureSql": true,
                "name": "$SiteCommon$/pages-gallery/sql.html",
                "newSqlDatabase": "Workforce",
                "showAzureSql": false,
                "showNewSqlOption": "true",
                "showSkuS1": true,
                "sqlInstance": "NewSql",
                "sqlSku": "S1",
                "subtitle": "$translate(INIT_SQL_TITLE)",
                "title": "$translate(INIT_SQL_TITLE)"
            },
            {
                "displayname": "Customize",
                "name": "$SiteCommon$/pages-gallery/ax-customize.html",
                "useDefaultValidateButton": true
            },
            {
                "name": "$SiteCommon$/pages-gallery/choose-analysis-server.html",
                "displayname": "AAS",
                "showDescription": true,
                "ssasEnabled": "true"
            },
            {
                "displayname": "Login to Analysis Services",
                "name": "$SiteCommon$/pages-gallery/as-login.html",
                "oauthType": "as",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true' : 'false')"
            },
            {
                "name": "$SiteCommon$/pages-gallery/ssas.html",
                "displayname": "AAS Login",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true' : 'false')"
            },
            {
                "displayname": "Summary",
                "name": "$SiteCommon$/pages-gallery/summary.html",
                "values": {
                    "Target Server": "$(this.MS.DataStore.getValue('Server'))",
                    "Target Database": "$(this.MS.DataStore.getValue('Database'))",
                    "Target Username": "$(this.MS.DataStore.getValue('Username'))"
                },
                "ConnectorName": "$save('dynamicsax')",
                "AxReportName": "$save('WorkforceReport')",
                "AxMeasurementName": "$save('Workforce')"
            },
            {
                "displayname": "Deploy",
                "filename": "$save('WorkforceImportMode.pbix')",
                "filenameSSAS": "$save('WorkforceAs.pbix')",
                "name": "$SiteCommon$/pages-gallery/progress.html",
                "uniqueId": "$save(this.MS.UtilityService.getUniqueId(10))",
                "asDatabase": "WorkforceAsDb",
                "showCounts": true,
                "targetSchema": "wf"
            }
        ],

        "Actions": [
            {
                "displayname": "$translate(INIT_ACTION_DEPLOYING_SQL_SCRIPTS)",
                "name": "Microsoft-DeploySQLScripts",
                "SqlServerIndex": "0",
                "SqlScriptsFolder": "Database"
            },
            {
                "displayname": "$translate(INIT_ACTION_DEPLOYING_DATABASE_CONFIGURATION)",
                "name": "Microsoft-SetConfigValueInSql",
                "SqlConfigTable": "[wf].[configuration]",
                "SqlServerIndex": "0"
            },
            {
                "displayname": "$translate(INIT_ACTION_DEPLOYING_DATABASE_CONFIGURATION)",
                "name": "Microsoft-SetConfigValueInSql",
                "SqlConfigTable": "[wf].[configuration]",
                "SqlEntryName": "Tables",
                "SqlEntryValue": "Workforce_BICalendarOffsetsDimension_MATERIALIZED,Workforce_BICompanyView_MATERIALIZED,Workforce_BIDateDimensionValue_MATERIALIZED,Workforce_HcmBICurrentFixedCompensationEntity_MATERIALIZED,Workforce_HcmBICurrentPositionEntity_MATERIALIZED,Workforce_HCMBICurrentWorkerEntity_MATERIALIZED,Workforce_HcmBIDemographicsEntity_MATERIALIZED,Workforce_HcmBIEmploymentEntity_MATERIALIZED,Workforce_HcmBIFixedCompensationEntity_MATERIALIZED,Workforce_HcmBIJobEntity_MATERIALIZED,Workforce_HcmBIJobPreferredSkillEntity_MATERIALIZED,Workforce_HcmBIMassHireLineEntity_MATERIALIZED,Workforce_HcmBIMassHireProjectEntity_MATERIALIZED,Workforce_HcmBIPastPositionAssignmentEntity_MATERIALIZED,Workforce_HcmBIPerformanceEntity_MATERIALIZED,Workforce_HcmBIPersonSkillEntity_MATERIALIZED,Workforce_HcmBIPositionEntity_MATERIALIZED,Workforce_HcmBIPositionTrendEntity_MATERIALIZED,Workforce_HcmBITerminatedWorkerEntity_MATERIALIZED,Workforce_HcmBIWorkerBenefitEntity_MATERIALIZED,Workforce_HcmBIWorkerNameEntity_MATERIALIZED,Workforce_HcmBIWorkerTitleEntity_MATERIALIZED,Workforce_HcmBIWorkerTrendEntity_MATERIALIZED,Workforce_HcmSkillEntity_MATERIALIZED,Workforce_LogisticsPostalAddressExpanded_MATERIALIZED,Workforce_SRSANALYSISENUMS_MATERIALIZED",
                "SqlGroup": "SolutionTemplate",
                "SqlServerIndex": "0",
                "SqlSubGroup": "StandardConfiguration"
            },
            {
                "displayname": "$translate(INIT_ACTION_DEPLOYING_DATABASE_CONFIGURATION)",
                "name": "Microsoft-SetConfigValueInSql",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')",
                "SqlConfigTable": "[wf].[configuration]",
                "SqlEntryName": "FunctionName",
                "SqlEntryValue": "$run('asscheduler' + this.MS.DataStore.getValue('uniqueId'))",
                "SqlGroup": "SolutionTemplate",
                "SqlServerIndex": "0",
                "SqlSubGroup": "SSAS"
            },
            {
                "displayname": "$translate(INIT_ACTION_DEPLOYING_DATABASE_CONFIGURATION)",
                "name": "Microsoft-SetConfigValueInSql",
                "skip": "$run(this.MS.DataStore.getAllValues('azureSqlDisabled')[0] === 'true' || this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')",
                "SqlConfigTable": "[wf].[configuration]",
                "SqlEntryName": "FunctionName",
                "SqlEntryValue": "$run('asscheduler' + this.MS.DataStore.getValue('uniqueId'))",
                "SqlGroup": "SolutionTemplate",
                "SqlServerIndex": "0",
                "SqlSubGroup": "SSAS"
            },
            {
                "displayname": "$translate(NOTIFIER_CONFIGURE_NOTIFIER_APP)",
                "name": "Microsoft-SetConfigValueInSql",
                "skip": "$run(!this.MS.DataStore.getValue('SendCompletionNotification'))",
                "SqlConfigTable": "[wf].[configuration]",
                "SqlEntryName": "InitialPullDone",
                "SqlEntryValue": "False",
                "SqlGroup": "SolutionTemplate",
                "SqlServerIndex": "0",
                "SqlSubGroup": "Notifier"
            },
            {
                "DeploymentName": "AxOdataInsert",
                "displayname": "$translate(AX_UPDATE_CONFIGURATION)",
                "name": "Microsoft-UpdateAxConfigurationEntity"
            },
            {
                "DeploymentName": "SqlConnectionDeployment",
                "displayname": "$translate(NOTIFIER_CREATING_DATABASE_CONNECTION)",
                "name": "Microsoft-CreateSqlConnector",
                "ApiConnectionName": "$save('sqlNotifierConnection')"
            },
            {
                "DeploymentName": "LogicApp",
                "displayname": "$translate(INIT_ACTION_DEPLOYING_LOGIC_APP)",
                "name": "Microsoft-DeployAxLogicApp"
            },
            {
                "DeploymentName": "NotifierLogicApp",
                "displayname": "$translate(NOTIFIER_CREATING_NOTIFIER_APP)",
                "name": "Microsoft-DeployNotifierLogicApp",
                "logicAppName": "notifierLogicApp",
                "skip": "$run(!this.MS.DataStore.getValue('SendCompletionNotification'))"
            },
            {
                "displayname": "$translate(NOTIFIER_CONFIGURE_NOTIFIER_APP)",
                "name": "Microsoft-ConfigureNotifier",
                "SqlConfigTable": "[wf].[configuration]"
            },
            {
                "ASDatabase": "CreditCollections",
                "displayname": "$translate(INIT_ACTION_DEPLOYING_AS_MODEL)",
                "name": "Microsoft-DeployAzureASModel",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')",
                "SqlConnectionString": "$dsall(SqlConnectionString)[0]",
                "xmlaFilePath": "Service/AzureAS/Workforce.xmla"
            },
            {
                "DeploymentName": "ASFunction",
                "displayname": "$translate(INIT_ACTION_DEPLOYING_AS_SCHEDULER)",
                "FunctionName": "$save('asscheduler' + this.MS.DataStore.getValue('uniqueId'))",
                "name": "Microsoft-DeployAzureFunction",
                "RepoUrl": "https://github.com/MohaaliMicrosoft/AnalysisServicesRefresh",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')",
                "sku": "Standard"
            },
            {
                "DeploymentName": "ASFunction",
                "displayname": "$translate(INIT_ACTION_WAITING_AS_SCHEDULER)",
                "name": "Microsoft-WaitForArmDeploymentStatus",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')"
            },
            {
                "displayname": "Create Service Principal",
                "name": "Microsoft-CreateSpn",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')"
            },
            {
                "displayname": "Assign Service Principal Permission",
                "name": "Microsoft-AssignPermissionsForUser",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')",
                "UserToAdd": "$ds(SPNUser)",
                "ASDatabase": "CreditCollections"
            },
            {
                "AppSettingKeys": {
                    "appId": "$ds(SPNAppId)",
                    "appKey": "$ds(SPNKey)",
                    "username": "$ds(SPNUser)",
                    "tenantId": "$ds(SPNTenantId)",
                    "asServer": "$ds(ASServerUrl)",

                    "connStringSql": "$dsall(SqlConnectionString)[0]",
                    "schema": "[wf]",
                    "databaseAS": "CreditCollections",
                    "functionName": "$run('asscheduler' + this.MS.DataStore.getValue('uniqueId'))"
                },

                "DeploymentName": "ASFunction",
                "displayname": "$translate(INIT_ACTION_SETTING_UP_AS_SCHEDULER)",
                "name": "Microsoft-DeployAzureFunctionConnectionStrings",
                "skip": "$run(this.MS.DataStore.getValue('ssasDisabled') === 'true' ? 'true': 'false')"
            },
            {
                "displayname": "$translate(INIT_ACTION_WAITING_DATA)",
                "name": "Microsoft-GetDataPullStatus",
                "SqlServerIndex": 0,
                "TargetSchema": "wf"
            }
        ]
    }
}